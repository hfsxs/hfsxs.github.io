

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="æ‰¬å¸†">
  <meta name="keywords" content="">
  
    <meta name="description" content="Kubernetesé›†ç¾¤ä¸€åˆ‡çš†APIå¯¹è±¡ï¼Œæ‰€æœ‰æ“ä½œå’Œç»„ä»¶ä¹‹é—´çš„é€šä¿¡åŠå¤–éƒ¨ç”¨æˆ·å‘½ä»¤éƒ½æ˜¯é€šè¿‡è°ƒç”¨API Serverè¿›è¡Œå¤„ç†ã€‚å› æ­¤ï¼ŒAPI Serverå¯¹é›†ç¾¤çš„è®¿é—®è¯·æ±‚è¿›è¡Œèº«ä»½è®¤è¯ä¸é‰´æƒå³å¯å®ç°æ•´ä¸ªé›†ç¾¤çš„æƒé™ç®¡ç†ï¼Œä¹Ÿå³æ˜¯Kubernetes APIè®¿é—®æ§åˆ¶  è®¿é—®æ§åˆ¶æµç¨‹ Authenticationï¼Œå³è®¤è¯ï¼Œå®¢æˆ·ç«¯ä¸API Serverå»ºç«‹TLSåï¼ŒAPI Serverèº«ä»½è®¤è¯ç»„ä»¶å°†åˆ¤æ–­è¯¥è¯·æ±‚çš„ç”¨æˆ·">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetesé›†ç¾¤è®¿é—®æ§åˆ¶æœºåˆ¶è¯¦è§£">
<meta property="og:url" content="https://hfsxs.github.io/2022/03/31/Kubernetes%E9%9B%86%E7%BE%A4%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="æ‰¬å¸†">
<meta property="og:description" content="Kubernetesé›†ç¾¤ä¸€åˆ‡çš†APIå¯¹è±¡ï¼Œæ‰€æœ‰æ“ä½œå’Œç»„ä»¶ä¹‹é—´çš„é€šä¿¡åŠå¤–éƒ¨ç”¨æˆ·å‘½ä»¤éƒ½æ˜¯é€šè¿‡è°ƒç”¨API Serverè¿›è¡Œå¤„ç†ã€‚å› æ­¤ï¼ŒAPI Serverå¯¹é›†ç¾¤çš„è®¿é—®è¯·æ±‚è¿›è¡Œèº«ä»½è®¤è¯ä¸é‰´æƒå³å¯å®ç°æ•´ä¸ªé›†ç¾¤çš„æƒé™ç®¡ç†ï¼Œä¹Ÿå³æ˜¯Kubernetes APIè®¿é—®æ§åˆ¶  è®¿é—®æ§åˆ¶æµç¨‹ Authenticationï¼Œå³è®¤è¯ï¼Œå®¢æˆ·ç«¯ä¸API Serverå»ºç«‹TLSåï¼ŒAPI Serverèº«ä»½è®¤è¯ç»„ä»¶å°†åˆ¤æ–­è¯¥è¯·æ±‚çš„ç”¨æˆ·">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-03-31T14:51:26.000Z">
<meta property="article:modified_time" content="2023-12-31T12:59:38.556Z">
<meta property="article:author" content="æ‰¬å¸†">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="äº‘è®¡ç®—">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="å®¹å™¨äº‘">
<meta property="article:tag" content="äº‘åŸç”Ÿ">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Kubernetesé›†ç¾¤è®¿é—®æ§åˆ¶æœºåˆ¶è¯¦è§£ - æ‰¬å¸†</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"hfsxs.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":100,"cursorChar":"","loop":false,"scope":["home"]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"COPY"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>æ‰¬å¸†</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">Kubernetesé›†ç¾¤è®¿é—®æ§åˆ¶æœºåˆ¶è¯¦è§£</span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-03-31 22:51" pubdate>
          2022å¹´3æœˆ31æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.4k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          70 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Kubernetesé›†ç¾¤è®¿é—®æ§åˆ¶æœºåˆ¶è¯¦è§£</h1>
            
            
              <div class="markdown-body">
                
                <p>Kubernetesé›†ç¾¤ä¸€åˆ‡çš†APIå¯¹è±¡ï¼Œæ‰€æœ‰æ“ä½œå’Œç»„ä»¶ä¹‹é—´çš„é€šä¿¡åŠå¤–éƒ¨ç”¨æˆ·å‘½ä»¤éƒ½æ˜¯é€šè¿‡è°ƒç”¨API Serverè¿›è¡Œå¤„ç†ã€‚å› æ­¤ï¼ŒAPI Serverå¯¹é›†ç¾¤çš„è®¿é—®è¯·æ±‚è¿›è¡Œèº«ä»½è®¤è¯ä¸é‰´æƒå³å¯å®ç°æ•´ä¸ªé›†ç¾¤çš„æƒé™ç®¡ç†ï¼Œä¹Ÿå³æ˜¯Kubernetes APIè®¿é—®æ§åˆ¶</p>
<hr>
<h1 id="è®¿é—®æ§åˆ¶æµç¨‹"><a href="#è®¿é—®æ§åˆ¶æµç¨‹" class="headerlink" title="è®¿é—®æ§åˆ¶æµç¨‹"></a>è®¿é—®æ§åˆ¶æµç¨‹</h1><ul>
<li>Authenticationï¼Œå³è®¤è¯ï¼Œå®¢æˆ·ç«¯ä¸API Serverå»ºç«‹TLSåï¼ŒAPI Serverèº«ä»½è®¤è¯ç»„ä»¶å°†åˆ¤æ–­è¯¥è¯·æ±‚çš„ç”¨æˆ·æ˜¯å¦ä¸ºèƒ½å¤Ÿè®¿é—®é›†ç¾¤çš„åˆæ³•ç”¨æˆ·ï¼Œè‹¥ä¸ºé<br>æ³•ç”¨æˆ·ï¼Œåˆ™è¿”å›401çŠ¶æ€ç ï¼Œå¹¶ç»ˆæ­¢è¯¥è¯·æ±‚</li>
<li>Authorizationï¼Œå³é‰´æƒï¼ŒAPI Serverå°†åˆ¤æ–­è¯¥è¯·æ±‚çš„ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡Œè¯·æ±‚ä¸­çš„æ“ä½œï¼Œè‹¥æ— æƒé™ï¼Œåˆ™è¿”å›403çš„çŠ¶æ€ç ï¼Œå¹¶ç»ˆæ­¢è¯¥è¯·æ±‚</li>
<li>AdmissionControlï¼Œå³å‡†å…¥æ§åˆ¶ï¼ŒAPI Serverçš„admissionæ§åˆ¶å™¨å°†åˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦æ˜¯ä¸€ä¸ªå®‰å…¨åˆè§„çš„è¯·æ±‚ï¼Œè‹¥éªŒè¯é€šè¿‡ï¼Œåˆ™è®¿é—®æ§åˆ¶æµç¨‹ç»“æŸï¼Œå¹¶<br>å°†è¯¥è¯·æ±‚è½¬æ¢ä¸ºKubernetes objectsç›¸åº”çš„å˜æ›´è¯·æ±‚ï¼Œæœ€ç»ˆå†™å…¥åˆ°ETCD</li>
</ul>
<h1 id="1-Authentication"><a href="#1-Authentication" class="headerlink" title="1.Authentication"></a>1.Authentication</h1><p>Kubernetesé›†ç¾¤ç”¨æˆ·åˆ†ä¸ºä¸¤ç±»ï¼Œå³ç”±é›†ç¾¤ç®¡ç†çš„æœåŠ¡è´¦å·å’Œæ™®é€šè´¦æˆ·ï¼Œè®¤è¯ç­–ç•¥å³æ˜¯å¯¹è¿™ä¸¤ç±»ç”¨æˆ·è¿›è¡Œç›¸å…³è®¤è¯ã€‚æ™®é€šè´¦æˆ·å¯¹åº”äºé›†ç¾¤ç”¨æˆ·ï¼Œç”±é›†ç¾¤ç®¡ç†å‘˜åˆ†é…ç§é’¥ï¼Œç§é’¥ä¿å­˜äº~.kube&#x2F;configï¼Œæ‰§è¡Œkubectlå‘½ä»¤æ—¶è‡ªåŠ¨è¯»å–ä»¥ä¾›API Serverè®¤è¯ï¼›æœåŠ¡è´¦æˆ·å¯¹åº”äºpodï¼Œç”±Kubernetes APIè‡ªåŠ¨åˆ›å»ºåŠç®¡ç†ï¼Œä¸”ä¸secretèµ„æºå…³è”æŒ‚è½½åˆ°podï¼Œä½œä¸ºè®¿é—®API Serverçš„å‡­è¯</p>
<p>è®¤è¯ç­–ç•¥æœ‰8ç§ï¼Œå¯ä»¥å¯åŠ¨ä¸€ç§æˆ–å¤šç§è®¤è¯æ–¹å¼ï¼Œåªè¦æœ‰ä¸€ç§è®¤è¯æ–¹å¼é€šè¿‡å³ä¸ºè®¤è¯é€šè¿‡ï¼Œä¸å†å¯¹å…¶å®ƒæ–¹å¼è®¤è¯</p>
<h2 id="1-1-X509å®¢æˆ·ç«¯è¯ä¹¦"><a href="#1-1-X509å®¢æˆ·ç«¯è¯ä¹¦" class="headerlink" title="1.1 X509å®¢æˆ·ç«¯è¯ä¹¦"></a>1.1 X509å®¢æˆ·ç«¯è¯ä¹¦</h2><p>å®¢æˆ·ç«¯å‘API Serverä¼ é€’SSLè¯ä¹¦å³å¯ç”¨å®¢æˆ·ç«¯è¯ä¹¦èº«ä»½è®¤è¯ï¼Œè‹¥è¯ä¹¦éªŒè¯é€šè¿‡ï¼Œåˆ™subjectä¸­çš„å…¬å…±åç§°ï¼Œå³Common Nameï¼Œå°±è¢«ä½œä¸ºè¯·æ±‚çš„ç”¨æˆ·åï¼Œ<br>è¯¥ç”¨æˆ·å³ä¸ºæ™®é€šç”¨æˆ·</p>
<pre><code class="hljs"># ä½¿ç”¨ç”¨æˆ·åtest00ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰ï¼Œä¸”è¯¥ç”¨æˆ·å±äºtestå’Œdevä¸¤ä¸ªç”¨æˆ·ç»„
openssl req -new -key test00.pem -out test00-csr.pem -subj &quot;/CN=test/O=test/O=dev&quot;
</code></pre>
<h2 id="1-2-Service-Accountï¼ŒæœåŠ¡è´¦æˆ·ä»¤ç‰Œ"><a href="#1-2-Service-Accountï¼ŒæœåŠ¡è´¦æˆ·ä»¤ç‰Œ" class="headerlink" title="1.2 Service Accountï¼ŒæœåŠ¡è´¦æˆ·ä»¤ç‰Œ"></a>1.2 Service Accountï¼ŒæœåŠ¡è´¦æˆ·ä»¤ç‰Œ</h2><p>é€šå¸¸ç”±API Serverè‡ªåŠ¨åˆ›å»ºå¹¶é€šè¿‡ServiceAccountå‡†å…¥æ§åˆ¶å™¨æŒ‚è½½åˆ°é›†ç¾¤ä¸­è¿è¡Œçš„Podä¸Šï¼Œå…è®¸é›†ç¾¤å†…è¿›ç¨‹ä¸API Serveré€šä¿¡</p>
<h2 id="1-3-Static-Tokenï¼Œé™æ€ä»¤ç‰Œ"><a href="#1-3-Static-Tokenï¼Œé™æ€ä»¤ç‰Œ" class="headerlink" title="1.3 Static Tokenï¼Œé™æ€ä»¤ç‰Œ"></a>1.3 Static Tokenï¼Œé™æ€ä»¤ç‰Œ</h2><p>tokenæ–‡ä»¶æ˜¯è‡³å°‘åŒ…å«3åˆ—çš„csvæ ¼å¼æ–‡ä»¶ï¼Œå³token, user name, user uidï¼Œgroupï¼ˆå¯é€‰ï¼‰,å…·ä½“æ ¼å¼ä¸ºï¼štoken,user,uid,â€group1,group2,group3â€</p>
<h2 id="1-4-Bootstrap-Tokensï¼Œå¼•å¯¼ä»¤ç‰Œ"><a href="#1-4-Bootstrap-Tokensï¼Œå¼•å¯¼ä»¤ç‰Œ" class="headerlink" title="1.4 Bootstrap Tokensï¼Œå¼•å¯¼ä»¤ç‰Œ"></a>1.4 Bootstrap Tokensï¼Œå¼•å¯¼ä»¤ç‰Œ</h2><p>ä¸»è¦ç”¨äºæ–°å»ºé›†ç¾¤æˆ–åœ¨ç°æœ‰é›†ç¾¤ä¸­æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œæ”¯æŒkubeadmï¼Œè¢«å®šä¹‰ä¸ºbootstrap.kubernetes.io&#x2F;tokenç±»å‹çš„Secretï¼Œå­˜å‚¨äº kube-systemå‘½åç©ºé—´ä¸­ï¼Œè¢«API Serverä¸Šçš„å¯åŠ¨å¼•å¯¼è®¤è¯ç»„ä»¶ï¼ˆBootstrap Authenticatorï¼‰è¯»å–</p>
<h2 id="1-5-OpenID-Connectï¼ˆOIDCï¼‰ä»¤ç‰Œ"><a href="#1-5-OpenID-Connectï¼ˆOIDCï¼‰ä»¤ç‰Œ" class="headerlink" title="1.5 OpenID Connectï¼ˆOIDCï¼‰ä»¤ç‰Œ"></a>1.5 OpenID Connectï¼ˆOIDCï¼‰ä»¤ç‰Œ</h2><p>ä¸»è¦ç”¨äºOAuth2è®¤è¯æœºåˆ¶ï¼Œå¦‚Azure Active Directory</p>
<h2 id="1-6-Webhookä»¤ç‰Œ"><a href="#1-6-Webhookä»¤ç‰Œ" class="headerlink" title="1.6 Webhookä»¤ç‰Œ"></a>1.6 Webhookä»¤ç‰Œ</h2><p>å³å…·æœ‰å›è°ƒæœºåˆ¶çš„è®¤è¯ç­–ç•¥</p>
<h2 id="1-7-Authenticating-Proxy"><a href="#1-7-Authenticating-Proxy" class="headerlink" title="1.7 Authenticating Proxy"></a>1.7 Authenticating Proxy</h2><p>å³è®¤è¯ä»£ç†ï¼Œä»è¯·æ±‚çš„å¤´éƒ¨å­—æ®µå€¼å¦‚X-Remote-Userè¾©è¯†ç”¨æˆ·ï¼Œèº«ä»½è®¤è¯ä»£ç†è´Ÿè´£è®¾ç½®è¯·æ±‚çš„å¤´éƒ¨å­—æ®µå€¼</p>
<h2 id="1-8-Basic-Authentication"><a href="#1-8-Basic-Authentication" class="headerlink" title="1.8 Basic Authentication"></a>1.8 Basic Authentication</h2><p>å³åŸºæœ¬èº«ä»½è®¤è¯ï¼ŒAPI Serverå°†äºè¯·æ±‚å¤´åŠ å…¥Basic BASE64ENCODED(USER:PASSWORD)</p>
<h1 id="2-Authorization"><a href="#2-Authorization" class="headerlink" title="2.Authorization"></a>2.Authorization</h1><p>å®¢æˆ·ç«¯è¯·æ±‚é€šè¿‡è®¤è¯ä¹‹åï¼ŒAPI Serverå°†æ ¹æ®æ‰€æœ‰æˆæƒç­–ç•¥åŒ¹é…è¯¥è¯·æ±‚çš„å±æ€§ï¼Œæ‰€æœ‰éƒ¨åˆ†éƒ½å¿…é¡»è¢«æŸäº›ç­–ç•¥å…è®¸æ‰èƒ½å†³å®šå…è®¸æˆ–æ‹’ç»ã€‚å®¢æˆ·ç«¯è¯·æ±‚å±æ€§åŒ…å«è¯·æ±‚è€…ç”¨æˆ·åã€è¯·æ±‚å¯¹è±¡åŠè¯·æ±‚æ“ä½œç­‰ã€‚æˆæƒç­–ç•¥ç”±æˆæƒæ¨¡å—å®šä¹‰ï¼Œè‹¥é›†ç¾¤é…ç½®äº†å¤šä¸ªé‰´æƒæ¨¡å—ï¼Œåˆ™å°†æŒ‰é¡ºåºè¿›è¡ŒåŒ¹é…</p>
<h2 id="2-1-å®¢æˆ·ç«¯è¯·æ±‚å±æ€§"><a href="#2-1-å®¢æˆ·ç«¯è¯·æ±‚å±æ€§" class="headerlink" title="2.1 å®¢æˆ·ç«¯è¯·æ±‚å±æ€§"></a>2.1 å®¢æˆ·ç«¯è¯·æ±‚å±æ€§</h2><h3 id="2-1-1-è¯·æ±‚ç”¨æˆ·åŠå…¶æ‰€å±ç»„"><a href="#2-1-1-è¯·æ±‚ç”¨æˆ·åŠå…¶æ‰€å±ç»„" class="headerlink" title="2.1.1 è¯·æ±‚ç”¨æˆ·åŠå…¶æ‰€å±ç»„"></a>2.1.1 è¯·æ±‚ç”¨æˆ·åŠå…¶æ‰€å±ç»„</h3><ul>
<li>ç”¨æˆ·ï¼Œèº«ä»½éªŒè¯ç¯èŠ‚æä¾›å¹¶é€šè¿‡çš„user</li>
<li>ç»„ï¼Œé€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰€å±ç»„åˆ—è¡¨</li>
<li>é¢å¤–ä¿¡æ¯ï¼Œç”±èº«ä»½éªŒè¯ç¯èŠ‚æä¾›çš„ä»»æ„å­—ç¬¦ä¸²é”®åˆ°å­—ç¬¦ä¸²å€¼çš„æ˜ å°„</li>
</ul>
<h3 id="2-1-2-è¯·æ±‚å¯¹è±¡"><a href="#2-1-2-è¯·æ±‚å¯¹è±¡" class="headerlink" title="2.1.2 è¯·æ±‚å¯¹è±¡"></a>2.1.2 è¯·æ±‚å¯¹è±¡</h3><p>è¯·æ±‚å¯¹è±¡å³æ˜¯è¯¥æ¬¡è¯·æ±‚æ‰€ç”³è¯·çš„é›†ç¾¤èµ„æºå¯¹è±¡ï¼Œåˆ†ä¸ºAPIèµ„æºå’Œéèµ„æºç«¯ç‚¹ä¸¤ç±»</p>
<h4 id="APIèµ„æºå¯¹è±¡"><a href="#APIèµ„æºå¯¹è±¡" class="headerlink" title="APIèµ„æºå¯¹è±¡"></a>APIèµ„æºå¯¹è±¡</h4><ul>
<li>APIï¼Œè¯·æ±‚æ‰€å¯¹åº”çš„APIèµ„æº</li>
<li>APIç»„ï¼Œè¯·æ±‚APIèµ„æºçš„æ‰€å±ç»„ï¼Œç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæ ¸å¿ƒAPIç»„</li>
<li>å‘½åç©ºé—´ï¼Œå³namespaceï¼Œè¯·æ±‚æ‰€å¯¹åº”çš„APIå¯¹è±¡æ‰€å±å‘½åç©ºé—´</li>
<li>resourceï¼Œå³è¯¥æ¬¡è¯·æ±‚çš„é›†ç¾¤å¯¹è±¡çš„IDæˆ–åç§°ï¼Œå¦‚podã€serviceç­‰ï¼Œå¯¹äºgetã€updateã€patchå’Œdeleteçš„èµ„æºè¯·æ±‚ï¼Œé¡»æä¾›èµ„æºåç§°çš„å­èµ„æº</li>
</ul>
<h4 id="éèµ„æºç«¯ç‚¹"><a href="#éèµ„æºç«¯ç‚¹" class="headerlink" title="éèµ„æºç«¯ç‚¹"></a>éèµ„æºç«¯ç‚¹</h4><ul>
<li>è¯·æ±‚è·¯å¾„ï¼Œéèµ„æºç«¯ç‚¹çš„è·¯å¾„ï¼Œå¦‚&#x2F;apiæˆ–&#x2F;healthz</li>
</ul>
<h3 id="2-1-3-è¯·æ±‚æ“ä½œ"><a href="#2-1-3-è¯·æ±‚æ“ä½œ" class="headerlink" title="2.1.3 è¯·æ±‚æ“ä½œ"></a>2.1.3 è¯·æ±‚æ“ä½œ</h3><h4 id="APIè¯·æ±‚æ“ä½œï¼Œç”¨äºAPIèµ„æºå¯¹è±¡çš„è¯·æ±‚ï¼Œå³æ˜¯å¯¹æ‰€è¯·æ±‚çš„é›†ç¾¤èµ„æºå¯¹è±¡çš„æ“ä½œ"><a href="#APIè¯·æ±‚æ“ä½œï¼Œç”¨äºAPIèµ„æºå¯¹è±¡çš„è¯·æ±‚ï¼Œå³æ˜¯å¯¹æ‰€è¯·æ±‚çš„é›†ç¾¤èµ„æºå¯¹è±¡çš„æ“ä½œ" class="headerlink" title="APIè¯·æ±‚æ“ä½œï¼Œç”¨äºAPIèµ„æºå¯¹è±¡çš„è¯·æ±‚ï¼Œå³æ˜¯å¯¹æ‰€è¯·æ±‚çš„é›†ç¾¤èµ„æºå¯¹è±¡çš„æ“ä½œ"></a>APIè¯·æ±‚æ“ä½œï¼Œç”¨äºAPIèµ„æºå¯¹è±¡çš„è¯·æ±‚ï¼Œå³æ˜¯å¯¹æ‰€è¯·æ±‚çš„é›†ç¾¤èµ„æºå¯¹è±¡çš„æ“ä½œ</h4><ul>
<li>POSTè¯·æ±‚ï¼Œå¯¹åº”äºAPIèµ„æºå¯¹è±¡çš„create</li>
<li>GETã€HEADè¯·æ±‚ï¼Œå¯¹åº”äºå•ä¸ªAPIèµ„æºå¯¹è±¡çš„getæˆ–é›†åˆèµ„æºçš„ist</li>
<li>PUTè¯·æ±‚ï¼Œå¯¹åº”äºAPIèµ„æºå¯¹è±¡çš„update</li>
<li>PATCHè¯·æ±‚ï¼Œå¯¹åº”äºAPIèµ„æºå¯¹è±¡çš„patch</li>
<li>DELETEè¯·æ±‚ï¼Œå¯¹åº”äºå•ä¸ªAPIèµ„æºå¯¹è±¡çš„deleteæˆ–é›†åˆèµ„æºçš„deletecollection</li>
</ul>
<h4 id="HTTPè¯·æ±‚æ“ä½œï¼Œç”¨äºéèµ„æºç«¯ç‚¹çš„è¯·æ±‚ï¼Œç±»ä¼¼äºHTTPè¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚getã€postã€putã€deleteç­‰"><a href="#HTTPè¯·æ±‚æ“ä½œï¼Œç”¨äºéèµ„æºç«¯ç‚¹çš„è¯·æ±‚ï¼Œç±»ä¼¼äºHTTPè¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚getã€postã€putã€deleteç­‰" class="headerlink" title="HTTPè¯·æ±‚æ“ä½œï¼Œç”¨äºéèµ„æºç«¯ç‚¹çš„è¯·æ±‚ï¼Œç±»ä¼¼äºHTTPè¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚getã€postã€putã€deleteç­‰"></a>HTTPè¯·æ±‚æ“ä½œï¼Œç”¨äºéèµ„æºç«¯ç‚¹çš„è¯·æ±‚ï¼Œç±»ä¼¼äºHTTPè¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚getã€postã€putã€deleteç­‰</h4><h2 id="2-2-RABCæˆæƒç­–ç•¥"><a href="#2-2-RABCæˆæƒç­–ç•¥" class="headerlink" title="2.2 RABCæˆæƒç­–ç•¥"></a>2.2 RABCæˆæƒç­–ç•¥</h2><p>é›†ç¾¤çš„æˆæƒç­–ç•¥ç”±æˆæƒæ¨¡å—å®šä¹‰ï¼Œå¯ç”¨çš„æˆæƒæ¨¡å—æœ‰6ä¸ªï¼Œå…¶ä¸­RBACæ¨¡å—ä¸ºé›†ç¾¤é»˜è®¤å¼ºåˆ¶å¼€å¯ä¸”æœ€ä¸ºå®Œå–„ã€‚RBACï¼Œå³Role Based Access Controlï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œç”±rbac.authorization.k8s.io APIèµ„æºç»„é©±åŠ¨é‰´æƒï¼Œé€šè¿‡APIåŠ¨æ€é…ç½®ç­–ç•¥</p>
<h3 id="é‰´æƒæµç¨‹"><a href="#é‰´æƒæµç¨‹" class="headerlink" title="é‰´æƒæµç¨‹"></a>é‰´æƒæµç¨‹</h3><ul>
<li><p>å®šä¹‰è§’è‰²èµ„æºå¯¹è±¡ï¼Œè§’è‰²æ˜¯é›†ç¾¤å†…æŸäº›èµ„æºï¼ˆapiGroupsã€resourcesï¼‰çš„æ“ä½œï¼ˆverbsï¼‰æƒé™çš„é›†åˆï¼Œå³ä¸ºå¯¹è±¡åŠå¯¹å…¶çš„æ“ä½œåŠ¨ä½œã€‚è§’è‰²åˆ†ä¸ºRole<br>å’ŒClusterRoleä¸¤ç±»ï¼Œå‰è€…å±äºå‘½åç©ºé—´çº§åˆ«ï¼Œåè€…å±äºé›†ç¾¤çº§åˆ«</p>
</li>
<li><p>å®šä¹‰è§’è‰²ç»‘å®šèµ„æºå¯¹è±¡ï¼Œå³æ˜¯å°†è§’è‰²ç»‘å®šåˆ°æŸä¸ªä¸»ä½“ï¼ˆsubjectï¼‰ï¼Œä»è€Œç»§æ‰¿äº†è§’è‰²çš„æ“ä½œæƒé™ã€‚ä¸»ä½“ä¸ºæŸä¸ªç”¨æˆ·ï¼ˆUserï¼‰ã€ç”¨æˆ·ç»„ï¼ˆGroupï¼‰ã€æœåŠ¡è´¦å·ï¼ˆServiceAccountï¼‰ï¼Œè§’è‰²ç»‘å®šå¯¹åº”äºè§’è‰²ï¼Œä¹Ÿåˆ†ä¸ºä¸¤ç±»ï¼Œå³RoleBindingï¼Œå°†Roleç»‘å®šåˆ°ä¸»ä½“ï¼›ClusterRoleBindingï¼Œå°†Roleå’ŒClusterRoleç»‘å®šåˆ°ä¸»ä½“</p>
</li>
</ul>
<h3 id="ä¼˜åŠ¿ç‰¹ç‚¹"><a href="#ä¼˜åŠ¿ç‰¹ç‚¹" class="headerlink" title="ä¼˜åŠ¿ç‰¹ç‚¹"></a>ä¼˜åŠ¿ç‰¹ç‚¹</h3><p>å¯¹é›†ç¾¤ä¸­çš„èµ„æºå’Œéèµ„æºæƒé™å‡æœ‰å®Œæ•´çš„è¦†ç›–ï¼Œèƒ½å¤Ÿåšåˆ°ç²¾ç»†æ§åˆ¶æ•´ä¸ªæˆæƒæµç¨‹å®Œå…¨ç”±å‡ ä¸ªAPIå¯¹è±¡å®Œæˆï¼ŒåŒå…¶ä»–APIå¯¹è±¡ä¸€æ ·ï¼Œå¯ç”¨kubectlæˆ–APIè¿›è¡Œæ“ä½œæ”¯æŒåœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´ï¼Œæ— é¡»é‡æ–°å¯åŠ¨API Server</p>
<h2 id="2-1-åˆ›å»ºç”¨æˆ·"><a href="#2-1-åˆ›å»ºç”¨æˆ·" class="headerlink" title="2.1 åˆ›å»ºç”¨æˆ·"></a>2.1 åˆ›å»ºç”¨æˆ·</h2><h3 id="2-1-1-åˆ›å»ºæ™®é€šç”¨æˆ·"><a href="#2-1-1-åˆ›å»ºæ™®é€šç”¨æˆ·" class="headerlink" title="2.1.1 åˆ›å»ºæ™®é€šç”¨æˆ·"></a>2.1.1 åˆ›å»ºæ™®é€šç”¨æˆ·</h3><pre><code class="hljs"># æ™®é€šç”¨æˆ·user001åˆ›å»ºç§é’¥
openssl genrsa -out user001.key 2048

# æ ¹æ®ç§é’¥åˆ›å»ºcsr(è¯ä¹¦ç­¾åè¯·æ±‚)æ–‡ä»¶
openssl req -new -key user001.key -subj &quot;/CN=user001/O=user00&quot; -out user001.csr

# æ ¹æ®ç§é’¥å’Œcsræ–‡ä»¶ç”Ÿæˆè¯ä¹¦
openssl x509 -req -in user001.csr -CA /opt/kubernetes/ssl/ca.pem -CAkey /opt/kubernetes/ssl/ca-key.pem -CAcreateserial -out user001.crt -days 365

# åˆ›å»ºé›†ç¾¤æ™®é€šç”¨æˆ·user001ï¼Œå°†å…¶è®¤è¯ä¿¡æ¯å†™å…¥kubeconfig
kubectl config set-credentials user001 --client-certificate=./user001.crt --client-key=./user001.key --embed-certs=true

# è®¾ç½®ä¸Šä¸‹æ–‡ï¼Œ é»˜è®¤ä¼šä¿å­˜åœ¨$HOME/.kube/config
kubectl config set-context user001@kubernetes --cluster=kubernetes --user=user001

# æŸ¥çœ‹å½“å‰ä¸Šä¸‹æ–‡
kubectl config get-contexts

# åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œå³åˆ‡æ¢user001ä¸ºå½“å‰ç”¨æˆ·
kubectl config use-context user001@kubernetes

# æŸ¥çœ‹å½“å‰ä¸Šä¸‹æ–‡
kubectl config get-contexts

# æ‰§è¡Œæµ‹è¯•å‘½ä»¤
kubectl get nodes
</code></pre>
<h3 id="2-1-2-åˆ›å»ºæœåŠ¡è´¦æˆ·"><a href="#2-1-2-åˆ›å»ºæœåŠ¡è´¦æˆ·" class="headerlink" title="2.1.2 åˆ›å»ºæœåŠ¡è´¦æˆ·"></a>2.1.2 åˆ›å»ºæœåŠ¡è´¦æˆ·</h3><pre><code class="hljs">kubectl create serviceaccount sa001
# serviceaccountæ–°å¢secret
kubectl patch serviceaccount sa001 -p &#39;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;myregistrykey&quot;&#125;]&#125;&#39;
# åˆ›å»ºç»‘å®šsaçš„podï¼Œä½¿å…¶è®¤è¯ç§æœ‰ä»“åº“
vi nginx-sa001.yaml


apiVersion: v1
kind: Pod
metadata:
  name: nginx-sa001
spec:
  containers:
  - name: nginx
    image: sword618/nginx
    imagePullPolicy: IfNotPresent
serviceAccountName: sa001
</code></pre>
<h2 id="2-2-åˆ›å»ºè§’è‰²"><a href="#2-2-åˆ›å»ºè§’è‰²" class="headerlink" title="2.2 åˆ›å»ºè§’è‰²"></a>2.2 åˆ›å»ºè§’è‰²</h2><h3 id="2-2-1-è§’è‰²é…ç½®å‚æ•°"><a href="#2-2-1-è§’è‰²é…ç½®å‚æ•°" class="headerlink" title="2.2.1 è§’è‰²é…ç½®å‚æ•°"></a>2.2.1 è§’è‰²é…ç½®å‚æ•°</h3><ul>
<li><p>APIGroupï¼Œå³è§’è‰²æ‰€ä½œç”¨çš„APIèµ„æºç»„ï¼Œå¯é€‰é¡¹ï¼šâ€œâ€,â€œappsâ€, â€œautoscalingâ€, â€œbatchâ€</p>
</li>
<li><p>Resourceï¼Œå³è§’è‰²æ‰€ä½œç”¨çš„èµ„æºå¯¹è±¡ï¼Œå¯é€‰é¡¹ï¼šâ€œservicesâ€, â€œendpointsâ€, â€œpodsâ€,â€œsecretsâ€,â€œconfigmapsâ€,â€œcrontabsâ€,â€œdeploymentsâ€,â€œjobsâ€,â€œnodesâ€,â€œrolebindingsâ€,â€œclusterrolesâ€,â€œdaemonsetsâ€,â€œreplicasetsâ€,â€œstatefulsetsâ€,â€œhorizontalpodautoscalersâ€,â€œreplicationcontrollersâ€,â€œcronjobsâ€</p>
</li>
<li><p>Verbsï¼Œå³è§’è‰²çš„åŠ¨ä½œæƒé™ï¼Œå¯é€‰é¡¹ï¼šâ€œgetâ€, â€œlistâ€, â€œwatchâ€, â€œcreateâ€, â€œupdateâ€, â€œpatchâ€, â€œdeleteâ€, â€œexecâ€</p>
</li>
</ul>
<h3 id="2-2-2-åˆ›å»ºRole"><a href="#2-2-2-åˆ›å»ºRole" class="headerlink" title="2.2.2 åˆ›å»ºRole"></a>2.2.2 åˆ›å»ºRole</h3><pre><code class="hljs">vi role.yaml


kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: test
  name: role-default-all
rules:
  - apiGroups:
    - &quot;*&quot;
    resources:
    - pods
    - deployments
    - services
    verbs:
    - get
    - watch
    - list
    - create
    - delete
    - update
    - patch
    - exec
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: role-default-log
rules:
- apiGroups: [&quot;&quot;]
  # è®¾ç½®è§’è‰²æ‰€ä½œç”¨é›†ç¾¤å¯¹è±¡ä¸ºå­èµ„æº
  resources: [&quot;pods&quot;, &quot;pods/log&quot;,&quot;pods/status&quot;]
  verbs: [&quot;get&quot;, &quot;list&quot;]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: role-default-redis-conf-update
rules:
- apiGroups: [&quot;&quot;]
  # è®¾ç½®è§’è‰²æ‰€ä½œç”¨é›†ç¾¤å¯¹è±¡ä¸ºæŸä¸ªæŒ‡å®šçš„å¯¹è±¡å®ä¾‹
  resources: [&quot;configmaps&quot;]
  resourceNames: [&quot;redis-conf&quot;]
  verbs: [&quot;update&quot;, &quot;get&quot;]
</code></pre>
<h3 id="2-2-3-åˆ›å»ºClusterRole"><a href="#2-2-3-åˆ›å»ºClusterRole" class="headerlink" title="2.2.3 åˆ›å»ºClusterRole"></a>2.2.3 åˆ›å»ºClusterRole</h3><pre><code class="hljs">vi clusterrole.yaml


apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: clusterrole-read
rules:
  - apiGroups: [&quot;&quot;]
    # è®¾ç½®è§’è‰²æ‰€ä½œç”¨é›†ç¾¤å¯¹è±¡ä¸ºé›†ç¾¤æ‰€æœ‰èµ„æº
    resources: [&quot;*&quot;]
    verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: clusterrole-nodes-read
rules:
  - apiGroups: [&quot;&quot;]
  # è®¾ç½®è§’è‰²æ‰€ä½œç”¨é›†ç¾¤å¯¹è±¡ä¸ºnode
  resources: [&quot;nodes&quot;]
  verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: clusterrole-nonresource
rules:
  # è®¾ç½®è§’è‰²æ‰€ä½œç”¨é›†ç¾¤å¯¹è±¡ä¸ºéèµ„æºç«¯ç‚¹ï¼Œæ”¯æŒé€šé…ç¬¦
  - nonResourceURLs: [&quot;/healthz&quot;, &quot;/healthz/*&quot;]
    verbs: [&quot;get&quot;, &quot;post&quot;]
</code></pre>
<h2 id="2-3-åˆ›å»ºè§’è‰²ç»‘å®š"><a href="#2-3-åˆ›å»ºè§’è‰²ç»‘å®š" class="headerlink" title="2.3 åˆ›å»ºè§’è‰²ç»‘å®š"></a>2.3 åˆ›å»ºè§’è‰²ç»‘å®š</h2><h3 id="2-3-1-åˆ›å»ºRoleBinding"><a href="#2-3-1-åˆ›å»ºRoleBinding" class="headerlink" title="2.3.1 åˆ›å»ºRoleBinding"></a>2.3.1 åˆ›å»ºRoleBinding</h3><pre><code class="hljs">vi user-role.yaml

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: user001-role
  namespace: default
# è®¾ç½®è§’è‰²ç»‘å®šçš„ä¸»ä½“ï¼Œå¯æŒ‡å®šå¤šä¸ª
subjects:
- kind: User
  # è®¾ç½®è§’è‰²ç»‘å®šæ‰€ä½œç”¨çš„ç”¨æˆ·
  name: user001
  apiGroup: rbac.authorization.k8s.io
- kind: ServiceAccount
  name: kube-system-sa-default
  # è®¾ç½®è§’è‰²ç»‘å®šæ‰€ä½œç”¨çš„æœåŠ¡è´¦æˆ·ï¼Œå³kube-systemå‘½åç©ºé—´çš„é»˜è®¤æœåŠ¡è´¦æˆ·
  namespace: kube-system
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  # è®¾ç½®ç»‘å®šçš„è§’è‰²ä¸ºRoleï¼Œå¼•ç”¨Roleåç§°
  name: role-default-all
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: user002-role
subjects:
- kind: Group
  name: user002
  apiGroup: rbac.authorization.k8s.io
- kind: Group
  # è®¾ç½®è§’è‰²ç»‘å®šæ‰€ä½œç”¨çš„æœåŠ¡è´¦æˆ·ï¼Œå³æ‰€æœ‰å‘½åç©ºé—´çš„æœåŠ¡è´¦æˆ·
  name: system:serviceaccounts
  apiGroup: rbac.authorization.k8s.io
roleRef:
  # è®¾ç½®ç»‘å®šçš„è§’è‰²ä¸ºClusterRoleï¼Œç”¨äºè·¨å‘½åç©ºé—´çš„æ•´ä¸ªé›†ç¾¤çš„æˆæƒ
  kind: ClusterRole
  name: clusterrole-read
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<h3 id="2-3-2-åˆ›å»ºClusterRoleBinding"><a href="#2-3-2-åˆ›å»ºClusterRoleBinding" class="headerlink" title="2.3.2 åˆ›å»ºClusterRoleBinding"></a>2.3.2 åˆ›å»ºClusterRoleBinding</h3><pre><code class="hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: user003-role
subjects:
- kind: Group
  # è®¾ç½®è§’è‰²ç»‘å®šæ‰€ä½œç”¨çš„ç”¨æˆ·ï¼Œå³æ‰€æœ‰å·²é€šè¿‡è®¤è¯çš„ç”¨æˆ·
  name: system:authenticated
  apiGroup: rbac.authorization.k8s.io
- kind: Group
  # è®¾ç½®è§’è‰²ç»‘å®šæ‰€ä½œç”¨çš„æœåŠ¡è´¦æˆ·ï¼Œå³defaultå‘½åç©ºé—´ä¸­å±äºdevç»„çš„æ‰€æœ‰æœåŠ¡è´¦æˆ·
  name: system:serviceaccounts:dev
  apiGroup: rbac.authorization.k8s.io
  namespace: default
roleRef:
   kind: ClusterRole
  name: clusterrole-nonresource
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<h1 id="3-AdmissionControl"><a href="#3-AdmissionControl" class="headerlink" title="3.AdmissionControl"></a>3.AdmissionControl</h1><p>å®¢æˆ·ç«¯è¯·æ±‚é€šè¿‡è®¤è¯å’Œé‰´æƒä¹‹åï¼Œå°±å°†è¿›å…¥å‡†å…¥æ§åˆ¶æµç¨‹ï¼Œä½œç”¨æ˜¯æ‹¦æˆªæ‰æŸäº›ä¸åˆè§„çš„è¯·æ±‚ã€‚æ‹¦æˆªè§„åˆ™ç”±å‡†å…¥æ§åˆ¶å™¨å†³å®šï¼Œå‡†å…¥æ§åˆ¶å™¨ç”±ä¸€ç³»åˆ—æ’ä»¶<br>æ„æˆï¼Œç”±é›†ç¾¤ç®¡ç†å‘˜é…ç½®ï¼Œè‹¥è¯·æ±‚è¢«ä»»ä¸€æ§åˆ¶å™¨æ‹’ç»ï¼Œåˆ™æ•´ä¸ªè¯·æ±‚å°†ç«‹å³è¢«æ‹’ç»ï¼Œå¹¶å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯ç ã€‚æ­¤å¤–ï¼Œå‡†å…¥æ§åˆ¶å™¨è¿˜èƒ½å¤Ÿä¿®æ”¹è¯·æ±‚å‚æ•°ä»¥å®Œ<br>æˆä¸€äº›è‡ªåŠ¨åŒ–çš„ä»»åŠ¡ï¼Œæ¯”å¦‚Service Accountè¿™ä¸ªæ§åˆ¶å™¨<br>å‡†å…¥æ§åˆ¶å™¨æ’ä»¶é€šè¿‡apiserverç»„ä»¶é…ç½®ï¼Œå…·ä½“é…ç½®é¡¹æ˜¯admission_controlï¼Œå…¶å€¼ä¸ºä¸€ä¸²é€—å·è¿æ¥çš„æ’ä»¶åç§°ï¼Œé›†ç¾¤é»˜è®¤å¯ç”¨çš„å‡†å…¥æ§åˆ¶å™¨æ’ä»¶æŸ¥è¯¢å‘½ä»¤ä¸ºï¼škube-apiserver -h | grep enable-admission-plugins</p>
<h2 id="å¸¸ç”¨å‡†å…¥æ§åˆ¶å™¨"><a href="#å¸¸ç”¨å‡†å…¥æ§åˆ¶å™¨" class="headerlink" title="å¸¸ç”¨å‡†å…¥æ§åˆ¶å™¨"></a>å¸¸ç”¨å‡†å…¥æ§åˆ¶å™¨</h2><ul>
<li>AlwaysPullImagesï¼Œä¿®æ”¹æ–°åˆ›å»ºpodçš„é•œåƒæ‹‰å–ç­–ç•¥ä¸ºAlwaysï¼Œç”¨äºå¤šç§Ÿæˆ·é›†ç¾¤ï¼Œè¡¨æ˜ç§æœ‰é•œåƒåªèƒ½è¢«æœ‰å‡­è¯çš„äººä½¿ç”¨ï¼Œå¦åˆ™ä»»ä½•ç”¨æˆ·çš„podéƒ½å¯é€šè¿‡å·²æ‹‰å–åˆ°èŠ‚ç‚¹ä¸Šçš„é•œåƒ</li>
<li>DefaultStorageClassï¼Œç”¨äºè®¾å®šé»˜è®¤å­˜å‚¨ç±»</li>
<li>DefaultIngressClassï¼Œç”¨äºè®¾å®šé»˜è®¤Ingressç±»</li>
<li>EventRateLimitï¼Œç”¨äºè®¾å®šäº‹ä»¶é€Ÿç‡é™åˆ¶ï¼Œç¼“è§£API Serverçš„å‹åŠ›ï¼Œå³æ ¹æ®å‘½åç©ºé—´ã€ç”¨æˆ·ç­‰æ¡ä»¶è®¾ç½®ç›¸åº”çš„API Serverçš„QPSç­‰</li>
<li>NamespaceAutoProvisionï¼Œç”¨äºè‡ªåŠ¨åˆ›å»ºå‘½åç©ºé—´çš„é›†ç¾¤ï¼Œå³è¯·æ±‚çš„å‘½åç©ºé—´ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º</li>
<li>NamespaceExistsï¼Œç”¨äºå‰”é™¤è®¿é—®é›†ç¾¤ä¸å­˜åœ¨çš„å‘½åç©ºé—´çš„è¯·æ±‚</li>
<li>NamespaceLifecycleï¼Œç”¨äºç¡®ä¿å¤„äºTerminationçŠ¶æ€çš„å‘½ä»¤ç©ºé—´ä¸å†æ¥æ”¶æ–°å¯¹è±¡åˆ›å»ºè¯·æ±‚ï¼Œå¹¶æ‹’ç»è¯·æ±‚ä¸å­˜åœ¨çš„å‘½åç©ºé—´ï¼Œè¿˜å¯ä»¥é˜²æ­¢åˆ é™¤ç³»ç»Ÿä¿ç•™çš„å‘½åç©ºé—´ï¼Œå¦‚defaultã€kube-systemã€kube-publicç­‰ï¼Œå»ºè®®å¼€å¯</li>
<li>NodeRestrictionï¼Œç”¨äºè®¾å®škubeletä¿®æ”¹nodeä¸podçš„é™åˆ¶æ¡ä»¶ï¼Œå³åªå¯ä¿®æ”¹ç»‘å®šåˆ°nodeæœ¬èº«çš„Pod</li>
<li>PersistentVolumeClaimResizeï¼Œç”¨äºé¢å¤–éªŒè¯PVCå®¹é‡è°ƒæ•´çš„è¯·æ±‚ï¼Œä¸ExpandPersistentVolumesé…åˆä½¿ç”¨</li>
<li>ServiceAccountï¼Œç”¨äºå®ç°ServiceAccountçš„è‡ªåŠ¨åŒ–ï¼Œä½¿ç”¨æœåŠ¡è´¦æˆ·çš„é›†ç¾¤å»ºè®®å¼€å¯</li>
<li>TaintNodesByConditionï¼Œç”¨äºç»™æ–°å»ºèŠ‚ç‚¹æ·»åŠ NotReadyå’ŒNoScheduleæ±¡ç‚¹ï¼Œé˜²æ­¢é™æ€æ¡ä»¶çš„å‘ç”Ÿï¼Œé¿å…Podåœ¨æ›´æ–°èŠ‚ç‚¹æ±¡ç‚¹ä»¥å‡†ç¡®åæ˜ å…¶æ‰€æŠ¥å‘ŠçŠ¶å†µä¹‹å‰å°±è¢«è°ƒåº¦åˆ°æ–°èŠ‚ç‚¹ä¸Š</li>
</ul>
<hr>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.orchome.com/1308">https://www.orchome.com/1308</a></li>
<li><a target="_blank" rel="noopener" href="http://docs.kubernetes.org.cn/51.html">http://docs.kubernetes.org.cn/51.html</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35745940/article/details/120693490">https://blog.csdn.net/qq_35745940/article/details/120693490</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43936969/article/details/106318259">https://blog.csdn.net/weixin_43936969/article/details/106318259</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/security/controlling-access">https://kubernetes.io/zh/docs/concepts/security/controlling-access</a></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%B7%A5%E4%BD%9C/" class="category-chain-item">å·¥ä½œ</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Linux/">#Linux</a>
      
        <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">#äº‘è®¡ç®—</a>
      
        <a href="/tags/Kubernetes/">#Kubernetes</a>
      
        <a href="/tags/%E5%AE%B9%E5%99%A8%E4%BA%91/">#å®¹å™¨äº‘</a>
      
        <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/">#äº‘åŸç”Ÿ</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Kubernetesé›†ç¾¤è®¿é—®æ§åˆ¶æœºåˆ¶è¯¦è§£</div>
      <div>https://hfsxs.github.io/2022/03/31/Kubernetesé›†ç¾¤è®¿é—®æ§åˆ¶æœºåˆ¶è¯¦è§£/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>æ‰¬å¸†</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2022å¹´3æœˆ31æ—¥</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>æ›´æ–°äº</div>
          <div>2023å¹´12æœˆ31æ—¥</div>
        </div>
      
      <div class="license-meta-item">
        <div>è®¸å¯åè®®</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/04/26/Kubernetes%E9%9B%86%E7%BE%A4Ingress%E8%AF%A6%E8%A7%A3/" title="Kubernetesé›†ç¾¤Ingressè¯¦è§£">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Kubernetesé›†ç¾¤Ingressè¯¦è§£</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/03/16/KVM%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/" title="KVMç£ç›˜ç®¡ç†">
                        <span class="hidden-mobile">KVMç£ç›˜ç®¡ç†</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'hfsxs/hexo-comments');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  

<div>
<span id="timeDate"> æ­£åœ¨è½½å…¥å¤©æ•°...</span>
<span id="times"> è½½å…¥æ—¶åˆ†ç§’...</span>
<script>
    var now = new Date();
    function createtime(){
        var grt= new Date("1/12/2025 01:15:00");
        now.setTime(now.getTime()+250);
        days = (now - grt) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);
        hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum);
        hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){
            hnum = "0" + hnum;
        }
        minutes = (now - grt) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes);
        if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
        }
        seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if(String(snum).length ==1 ){
                snum = "0" + snum;
        }
        document.getElementById("timeDate").innerHTML = "ğŸš€æœ¬ç«™å·²è¿è¡Œ "+dnum+"&nbsp å¤©";
        document.getElementById("times").innerHTML = hnum + "&nbsp æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
    }
    setInterval("createtime()",250);
</script>
</div>

</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
